describe('Form edition', function() {
    beforeEach(function(){
        cy.visit('/index.php/view/map/?repository=testsrepository&project=layer_treeview')
    })

    it('click layer button', function(){
        cy.get('#layer-layer_treeview > td:nth-child(1) > button:nth-child(2)').should('not.have.class', 'checked')
        cy.get('#group-group1 > td:nth-child(1) > button:nth-child(2)').should('not.have.class', 'checked')
    })

    it('click layer expander', function(){
        cy.get('#layer-layer_treeview > td:nth-child(1) > a:nth-child(1)').click()
        cy.get('#layer-layer_treeview').should('have.class','expanded')
    })

    it('click group informations', function(){
        cy.get('#group-group1 > td:nth-child(1) > span:nth-child(3)').click()
        cy.get('#group-group1').should('have.class','selected')
    })

    it('click close button', function(){
        cy.get('#dock-close').click()
        cy.get('li.switcher').should('not.have.class','active')
    })

    it('click group button', function(){
        cy.get('#group-group1 > td:nth-child(1) > button:nth-child(2)').click()
        cy.get('#group-group1 > td:nth-child(1) > button:nth-child(2)').should('have.class', 'checked')
        cy.get('#layer-layer_treeview > td:nth-child(1) > button:nth-child(2)').should('have.class', 'checked')
    })

    it('click on another mutually exclusive layer', function(){
        cy.get('#layer-layer_mut_2 > td:nth-child(1) > button:nth-child(2)').click()
        cy.get('#layer-layer_mut_2 > td:nth-child(1) > button:nth-child(2)').should('have.class','checked')
        cy.get('#layer-layer_mut_1 > td:nth-child(1) > button:nth-child(2)').should('not.have.class','checked')
    })

    it('click on subgroup after mutually exclusive layer', function(){
        cy.get('#group-sub_group_mut > td:nth-child(1) > button:nth-child(2)').click()
        cy.get('#group-sub_group_mut > td:nth-child(1) > button:nth-child(2)').should('have.class','checked')
        cy.get('#layer-layer_mut_1 > td:nth-child(1) > button:nth-child(2)').should('not.have.class','checked')
    })

    it('checked layer', function(){
        cy.get('#layer-layer_treeview > td:nth-child(1) > button:nth-child(2)').click()
        cy.get('#layer-layer_treeview > td:nth-child(1) > button:nth-child(2)').should('have.class', 'checked')
        cy.get('#OpenLayers_Layer_WMS_2').should('not.be.visible')
    })

    it('map snapshot', () => {
        cy.wait(1000)
        // match element snapshot
        cy.get('#map').matchImageSnapshot('test_elem', {clip: { x: 238, y: 0, width: 2500, height: 800 }, blackout: ['#overview-box', '#navbar', '#attribution-box']})
    })

    it.only('test intercept', () => {
        cy.wait(1000)
        cy.intercept('**/index.php/**').as('map')
        cy.get('#layer-layer_treeview > td:nth-child(1) > button:nth-child(2)').click()
        //var convertedResponse = cy.wait('@map', {timeout:6000}).its('response.body')
        //convertedResponse = Cypress.Blob.blobToBase64String(convertedResponse)
        cy.wait('@map', {timeout:7500}).then((interception) => {
            //cy.wrap(Cypress.Blob.blobToBase64String(interception)).should('eq', 'data:image/png;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwH/rJ14UU156Pau1AAAAAElFTkSuQmCC')
            console.log(interception)
        })
        cy.wait(200)
    })
})
